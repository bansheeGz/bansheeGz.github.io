<!doctype html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76367732-7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-76367732-7');
    </script>

    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="BG Database is a in-game data management system for Unity3D game engine">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    
    <title>BansheeGz</title>

    <!-- Page styles -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="../../../css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.min.css">

    <link rel="stylesheet" href="../../../css/main.css">
    <link rel="stylesheet" href="../../../css/page.css">

    <link rel="icon" type="image/png" href="../../../images/BGIcon.png"/>
</head>
<body>


<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<style>
    #aBox a {
        color: white;
        font: 15px Helvetica, Arial, Sans-Serif;
    }

    #bg-navigation a {
        background-position: 50px;
    }
</style>


<script>
    function writeEmail(whom, at) {
        document.write("<a href='mail" + "to:" + whom + "@" + at + "'>" + whom + "@" + at + "</a>");
    }
</script>

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">

    <!--======================================================       Root  Header               -->
    <div class="bg-header mdl-layout__header mdl-layout__header--waterfall">
        <div class="mdl-layout__header-row" id="header">
          <span style="margin-left: -40px;">
              <a class="bg-header-a" href="/"><img src="../../../images/BGIconBig.png"></a>
          </span>
            <!-- Add spacer, to align navigation to the right in desktop -->
            <div class="mdl-layout-spacer"></div>
            <!-- Navigation -->
            <div class="bg-navigation-bag" id="bg-navigation">
                <nav class="bg-navigation mdl-navigation">
                    <a class="mdl-navigation__link mdl-typography--text-uppercase bg-navigation_link_active"
                       href="../../../BGDatabase">BG`Database</a>
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../BGLocalization">BG`Localization</a>
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../BGCurve">BG`Curve</a>
<!--                    <a class="mdl-navigation__link mdl-typography&#45;&#45;text-uppercase "-->
<!--                       href="../../../BGCurve/BGSplineColliders">BG`Spline_Colliders</a>-->
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../Blog">Blog</a>
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../Support">Support</a>
                </nav>
            </div>
            <button class="bg-menu-mobile mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect"
                    id="more-button">
                <i class="material-icons">more_vert</i>
            </button>
            <ul class="bg-menusub-mobile mdl-menu mdl-js-menu mdl-menu--bottom-right mdl-js-ripple-effect"
                for="more-button">
                <li class="mdl-menu__item"><a href="../../../BGDatabase">BG Database</a></li>
                <li class="mdl-menu__item"><a href="../../../BGLocalization">BG Localization</a></li>
                <li class="mdl-menu__item"><a href="../../../BGCurve">BG Curve</a></li>
                <li class="mdl-menu__item"><a href="../../../Support">Support</a></li>
                <li class="mdl-menu__item"><a href="../../../About">About Us</a></li>
            </ul>
        </div>
    </div>

    <!--
        <div style="min-height: 5px;background-color: #CCCCCC"></div>
        <div id="aBox" style="background-color: #ff69b4;height: 20px;color: white;text-align: center;">
            <b>
                Announcement: <a href="../../../BGDatabase"><b>BG Database</b></a> v. 1.1 is out!
        </b>
    </div>
    -->

    <div class="mdl-layout__content">
        <a name="top"></a>

        <div class="importantNote">
            <a href="http://u3d.as/16JW">BGDatabase is on SALE (50% off)</a>
        </div>


        <!--======================================================        Content (from Root)              -->
        




<link rel="stylesheet" href="../../../css/bgdatabase.css">
<link rel="stylesheet" href="../../../css/magnific-popup.css">
<script src="../../../js/jquery.magnific-popup.min.js"></script>

<script>
    $(document).ready(function () {
        $('.bg-image').magnificPopup({
            delegate: 'a',
            type: 'image',
//            gallery:{enabled:true},
            closeOnContentClick: true
        });
    });
</script>

<!--======================================================       BG Database Header               -->


<div class="mdl-grid">
    <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--hide-phone bg-sm  mdl-shadow--3dp">
        <ul id="leftmenu">
            <li class="pli databaseicon ">
                <a class="pa" href="../../../BGDatabase">BG Database Home</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Setup">Setup</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/HowToUse">How to use</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/GUIOverview">GUI Overview</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/CodeExamples">Code Examples</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Videos">Videos</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/SupportedFields">Field types</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/ExportImport">Export Import</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/DataBinding">Data Binding</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/MergeTool">Merge Tool</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Misc">Misc</a>
                    </li>
                    <li class="cli downloadicon ">
                        <a class="ca" href="../../../BGDatabase/Downloads">Downloads</a>
                    </li>
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../BGDatabase/CodeGeneration">Code Generation</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/CodeGeneration/ExtensionClasses">Extension Classes</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/CodeGeneration/MonoBehaviourClasses">MonoBehavior Classes</a>
                    </li>
<!--
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/CodeGeneration/DnaClasses">Dna Classes</a>
                    </li>
-->
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../BGDatabase/ThirdParty">Third-Party Integration</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/ThirdParty/Excel">Excel</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/ThirdParty/GoogleSheets">Google Sheets</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/ThirdParty/Playmaker">Playmaker</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/ThirdParty/Bolt">Bolt</a>
                    </li>
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../BGDatabase/Addons">Addons</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/SaveLoad">Save Load</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/CodeGeneration">Code Generation</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/LazyLoad">Lazy Load</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/LiveUpdate">Live Update</a>
                    </li>
                    <li class="cli  plic ">
                        <a class="ca" href="../../../BGDatabase/Addons/Multithreading">Multithreading</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/Modding">Modding</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/Settings">Settings</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/Addons/Localization">Localization</a>
                    </li>
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../BGDatabase/API">API</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/API/BGRepo">BGRepo</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/API/BGMetaEntity">BGMetaEntity</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/API/BGEntity">BGEntity</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../BGDatabase/API/BGField">BGField</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="mdl-cell--hide-desktop mdl-cell--hide-tablet mdl-cell--4-col-phone">
        <a class="pa" href="../../../BGDatabase">BG BGDatabase Home</a>
        <a class="pa" href="../../../BGDatabase/Setup">Setup</a>
        <a class="pa" href="../../../BGDatabase/HowToUse">How To Use</a>
        <a class="pa" href="../../../BGDatabase/Videos">Videos</a>
        <a class="pa" href="../../../BGDatabase/ExampleBreakdown">Example Breakdown</a>
        <a class="pa" href="../../../BGDatabase/SupportedFields">Fields</a>
        <a class="pa" href="../../../BGDatabase/ExportImport">Export Import</a>
        <a class="pa" href="../../../BGDatabase/DataBinding">Data Binding</a>
        <a class="pa" href="../../../BGDatabase/Events">Events</a>
        <a class="pa" href="../../../BGDatabase/CodeGeneration">Code Generation</a>
        <a class="pa" href="../../../BGDatabase/Addons">Addons</a>
    </div>
    <div class="mdl-cell mdl-cell--9-col mdl-cell--6-col-tablet mdl-cell--3-col-phone">
        <div class="bg-main mdl-shadow--3dp">
            <div class="bg-main-title">
                <h3>Multithreading add-on</h3>
            </div>

            <!--======================================================        BG Database Content              -->
            <div id="content">
            

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=cs&amp;skin=desert"></script>


<h4>Description</h4>
<p>
    BGDatabase itself is not thread-safe, it's meant to be called from main thread only (from MonoBehaviour scripts).
    Multi-threading addon creates environment, which can be accessed from multiple threads safely.
</p>

<h4 id="alternative">Alternative method</h4>
<p>
    There is alternative method to use  BGDatabase data in multi-threaded environment (for example, with Unity ECS).
    Use data from BGDatabase and create Unity ECS entities. Merge changes back to database on save if needed.
</p>
<ol>
    <li>Make sure you call database only from main thread (e.g. from MonoBehaviour classes)</li>
    <li>Create Unity ECS entities out of database data</li>
    <li>If you need some of these Unity ECS entities to be persistent, (e.g. they needs to be saved/loaded),
        store them back to database the moment they needs to be persisted, e.g, when the game needs to be saved.
        Run saving/loading on main thread.
    </li>
    <li>
        If you need to call database from multithreaded environment, use <code>BGMainThreadRunner.RunOnMainThread(Action action)</code>.
        This will add action to the jobs list to be run on main thread.
        Make sure you call at sparingly, at some relatively rare condition, otherwise it can become a bottleneck.
    </li>
</ol>

<h4>What can I do with multi-threading addon?</h4>
<ol>
    <li>You can chose which tables you want to be accessible for multi-threading operations.</li>
    <li>You can merge changes back to main database either manually or auto (on saving).
        Otherwise changes are not synchronized.
        Merging changes back is pretty expensive operation.
    </li>
    <li>MT addon has it's own code generator and API very similar to single-threaded API.</li>
    <li>Not all BGDatabase fields are available for multithreaded access.
        Read more about which fields are available below in <a href="">What I need to know before using MT Addon?</a> section.
        You can also see which fields are not supported in merge settings under "Merge" tab
    </li>
    <li>There are 2 types of transactions: lightweight, lock-free readonly transactions and very heavy write transactions.
        If you need to update data very often, consider using <a href="#alternative">Alternative method</a> instead (described above).
    </li>
</ol>

<h4>How multi-threading addon works?</h4>
<div class="bg-image">
    <a href="../../../images/BGDatabase/MTAddonReview.png"><img style="width: 400px" src="../../../images/BGDatabase/MTAddonReview.png"></a>
</div>

<h4 id="fields">What I need to know before using MT Addon?</h4>
<ol>
    <li>Lists fields, hashtable, Unity assets fields and fields, which reference objects (not structs) are not supported.</li>
    <li>All entities are structs, not classes. If result can be null, BGMTEntity? is used</li>
    <li>Entities are only marked as deleted inside transaction, the actual removal takes place at the end of transaction</li>
    <li>Write transactions can be executed asynchronously, so do not expect changes take effect right after the method call.
        If you need some code to be run after transaction finish, use (Action callback) as second parameter to BGRepo.M.Write method</li>
</ol>


<h4>Usage examples</h4>
<p>
    We tried our best to make multithreaded API very similar to single-threaded one.
    Also, we provide code generation for MT addon.
    Start working with multithreading environment by creating read-only or write transactions.
</p>
<pre class="prettyprint">
        //start read-only transaction (option 1)
        BGMTRepo mtRepo = BGRepo.M.RepoReadOnly;

	    //start read-only transaction (option 2)
	    BGRepo.M.Read(mtRepo =>
        {
            //access data from mtRepo here
        });

	    //start write transaction (the only option)
	    BGRepo.M.Write(mtRepo =>
        {
            // you can read and change data here.
			// This transaction can be run asynchronously (on separate thread),
			// so do not expect changes take effect right after the method call
        });
</pre>
<p>
    BGMTRepo has very similar methods to ones single-threaded API has.
    For example, to iterate through "Items" table rows, which have "damage" column value more than 10:
</p>
<pre class="prettyprint">
        BGRepo.M.Read(mtRepo =>
        {
            mtRepo["Items"].ForEachEntity(entity =>
            {
                print("Weapon: " + entity.Name);
            }, entity => entity.Get&lt;int&gt;("damage") > 10);
        });
</pre>
<p>
    And just like with single-threaded API, Code generation greatly simplify access to database by removing all boilerplate code
</p>
<pre class="prettyprint">
		BGRepo.M.Read(mtRepo =>
		{
			Items.ForEachEntity(mtRepo, item =>
			{
				print("Weapon: " + item.name);
			}, item => item.damage > 10);
		});
</pre>



<h4>Parameters</h4>
<table class="contentTable">
    <tr>
        <th>
            Parameter name
        </th>
        <th>
            Description
        </th>
    </tr>
    <tr>
        <td>Multi-threaded updates</td>
        <td>
            By default all update transaction are run on single thread one-by-one.
            Toggle this parameter on if you want to enable multithreaded updates.
            Note, multithreaded updates make 'lost updates' possible. Learn more about Lost updates
            <a href="https://codingsight.com/the-lost-update-problem-in-concurrent-transactions/">here</a>
        </td>
    </tr>
    <tr>
        <td>Meta list</td>
        <td>
            List of tables to include in multithreaded environment
        </td>
    </tr>
    <tr>
        <td>Merge on save</td>
        <td>
            Should the changes from multi-threaded environment be auto-merged back to main database before saving the game with <a href="../SaveLoad">SaveLoad</a> add-on
        </td>
    </tr>
    <tr>
        <td>Merge Settings</td>
        <td>
            Merge settings to use for merging changes back to main database.
            The same merge settings you use for Export/Import or Saving/Loading. Learn more about merge settings <a href="../../ExportImport#mergeSettings">here</a>
        </td>
    </tr>
</table>
            </div>

            <!--======================================================       BG Database Footer               -->
        </div>

    </div>
</div>



        <!--======================================================      Root Footer               -->
        <footer class="bg-footer mdl-mega-footer" style="clear:both;">
            <div class="mdl-mega-footer--top-section">
                <div class="mdl-mega-footer--middle-section bg-footer-email">
                    <table>
                        <tr>
                            <td>
                                <script language="JavaScript">
                                    writeEmail("support", "bansheegz.com")
                                </script>
                            </td>
                            <td>
                                or
                            </td>
                            <td>
                                <script language="JavaScript">
                                    writeEmail("admin", "bansheegz.com")
                                </script>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div style="text-align: center">
                <div id="share" style="display: inline-block;"></div>
            </div>
        </footer>
    </div>
</div>


</div>

<script defer src="https://code.getmdl.io/1.2.1/material.min.js"></script>

</body>
</html>
