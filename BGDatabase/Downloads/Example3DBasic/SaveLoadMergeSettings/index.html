<!doctype html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76367732-7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-76367732-7');
    </script>

    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="BG Database is an in-game data management system for Unity3D game engine with Google Sheets and Excel integration">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    
    <title>BansheeGz</title>

    <!-- Page styles -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.min.css">

    <link rel="stylesheet" href="../../../../css/main.css">
    <link rel="stylesheet" href="../../../../css/page.css">

    <link rel="icon" type="image/png" href="../../../../images/BGIcon.png"/>
</head>
<body>


<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<style>
    #aBox a {
        color: white;
        font: 15px Helvetica, Arial, Sans-Serif;
    }

    #bg-navigation a {
        background-position: 50px;
    }
</style>


<script>
    function writeEmail(whom, at) {
        document.write("<a href='mail" + "to:" + whom + "@" + at + "'>" + whom + "@" + at + "</a>");
    }
</script>

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">

    <!--======================================================       Root  Header               -->
    <div class="bg-header mdl-layout__header mdl-layout__header--waterfall">
        <div class="mdl-layout__header-row" id="header">
          <span style="margin-left: -40px;">
              <a class="bg-header-a" href="/"><img src="../../../../images/BGIconBig.png"></a>
          </span>
            <!-- Add spacer, to align navigation to the right in desktop -->
            <div class="mdl-layout-spacer"></div>
            <!-- Navigation -->
            <div class="bg-navigation-bag" id="bg-navigation">
                <nav class="bg-navigation mdl-navigation">
                    <a class="mdl-navigation__link mdl-typography--text-uppercase bg-navigation_link_active"
                       href="../../../../BGDatabase">BG`Database</a>
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../../BGLocalization">BG`Localization</a>
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../../BGCurve">BG`Curve</a>
<!--                    <a class="mdl-navigation__link mdl-typography&#45;&#45;text-uppercase "-->
<!--                       href="../../../../BGCurve/BGSplineColliders">BG`Spline_Colliders</a>-->
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../../Blog">Blog</a>
                    <a class="mdl-navigation__link mdl-typography--text-uppercase "
                       href="../../../../Support">Support</a>
                </nav>
            </div>
            <button class="bg-menu-mobile mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect"
                    id="more-button">
                <i class="material-icons">more_vert</i>
            </button>
            <ul class="bg-menusub-mobile mdl-menu mdl-js-menu mdl-menu--bottom-right mdl-js-ripple-effect"
                for="more-button">
                <li class="mdl-menu__item"><a href="../../../../BGDatabase">BG Database</a></li>
                <li class="mdl-menu__item"><a href="../../../../BGLocalization">BG Localization</a></li>
                <li class="mdl-menu__item"><a href="../../../../BGCurve">BG Curve</a></li>
                <li class="mdl-menu__item"><a href="../../../../Support">Support</a></li>
            </ul>
        </div>
    </div>

<!--        <div style="min-height: 5px;background-color: #CCCCCC"></div>-->
<!--        <div id="aBox" style="background-color: #ff69b4;height: 20px;color: white;text-align: center;">
            <b>
                MESSAGE HERE
        </b>
    </div>-->

    <div class="mdl-layout__content">
        <a name="top"></a>

        <!--======================================================        Content (from Root)              -->
        




<link rel="stylesheet" href="../../../../css/bgdatabase.css">
<link rel="stylesheet" href="../../../../css/magnific-popup.css">
<script src="../../../../js/jquery.magnific-popup.min.js"></script>

<script>
    $(document).ready(function () {
        $('.bg-image').magnificPopup({
            delegate: 'a',
            type: 'image',
//            gallery:{enabled:true},
            closeOnContentClick: true
        });
    });
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/rainbow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!--======================================================       BG Database Header               -->


<div class="mdl-grid">
    <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--hide-phone bg-sm  mdl-shadow--3dp">
        <ul id="leftmenu">
            <li class="pli databaseicon ">
                <script async src="https://cse.google.com/cse.js?cx=e1930f586f83c4862">
                </script>
                <div class="gcse-searchbox-only"></div>
                <a class="pa" href="../../../../BGDatabase">BG Database Home</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Setup">Setup</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/HowToUse">How to use</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/GUIOverview">GUI overview</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/GUITips">GUI tips and tricks</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/CodeExamples">Code Examples</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Videos">Videos</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/SupportedFields">Field types</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ExportImport">Export Import</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/DataBinding">Data Binding</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/GraphEditor">Graph Editor</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/MergeTool">Merge Tools</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Misc">Misc</a>
                    </li>
                    <li class="cli downloadicon  plic ">
                        <a class="ca" href="../../../../BGDatabase/Downloads">Downloads</a>
                    </li>
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../../BGDatabase/CodeGeneration">Code Generation</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/CodeGeneration/ExtensionClasses">Extension Classes</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/CodeGeneration/MonoBehaviourClasses">MonoBehavior
                            Classes</a>
                    </li>
                    <!--
                                        <li class="cli ">
                                            <a class="ca" href="../../../../BGDatabase/CodeGeneration/DnaClasses">Dna Classes</a>
                                        </li>
                    -->
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../../BGDatabase/ThirdParty">Third-Party Integration</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/Excel">Excel</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/GoogleSheets">Google Sheets</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/Bolt">Unity Visual Scripting (ex-Bolt)</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/Playmaker">Playmaker</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/FlowCanvas">Flow Canvas</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/NodeCanvas">Node Canvas</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/BehaviorDesigner">Behavior Designer</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/UNode">UNode</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/ThirdParty/GameCreator">Game Creator</a>
                    </li>
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../../BGDatabase/Addons">Addons</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/SaveLoad">Save Load</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/CodeGeneration">Code Generation</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/LazyLoad">Lazy Load</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/LiveUpdate">Live Update</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/Multithreading">Multithreading</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/Modding">Modding</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/Settings">Settings</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/Partition">Partitions</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/Diagram">Diagram</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/Addons/Localization">Localization</a>
                    </li>
                </ul>
            </li>
            <li class="pli ">
                <a class="pa " href="../../../../BGDatabase/API">API</a>
                <ul>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/API/BGRepo">BGRepo</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/API/BGMetaEntity">BGMetaEntity</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/API/BGEntity">BGEntity</a>
                    </li>
                    <li class="cli ">
                        <a class="ca" href="../../../../BGDatabase/API/BGField">BGField</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="mdl-cell--hide-desktop mdl-cell--hide-tablet mdl-cell--4-col-phone">
        <a class="pa" href="../../../../BGDatabase">BG BGDatabase Home</a>
        <a class="pa" href="../../../../BGDatabase/Setup">Setup</a>
        <a class="pa" href="../../../../BGDatabase/HowToUse">How To Use</a>
        <a class="pa" href="../../../../BGDatabase/Videos">Videos</a>
        <a class="pa" href="../../../../BGDatabase/ExampleBreakdown">Example Breakdown</a>
        <a class="pa" href="../../../../BGDatabase/SupportedFields">Fields</a>
        <a class="pa" href="../../../../BGDatabase/ExportImport">Export Import</a>
        <a class="pa" href="../../../../BGDatabase/DataBinding">Data Binding</a>
        <a class="pa" href="../../../../BGDatabase/Events">Events</a>
        <a class="pa" href="../../../../BGDatabase/CodeGeneration">Code Generation</a>
        <a class="pa" href="../../../../BGDatabase/Addons">Addons</a>
    </div>
    <div class="mdl-cell mdl-cell--9-col mdl-cell--6-col-tablet mdl-cell--3-col-phone">
        <div class="bg-main mdl-shadow--3dp">
            <div class="bg-main-title">
                <h3>Downloads</h3>
                
                <div style="margin-bottom: 10px;">
                    <div class="subTitle"><a class="backButton" href="../">&#8592; Back</a> Basic 3D example (SaveLoad merge settings)</div>
                </div>
                
            </div>

            <!--======================================================        BG Database Content              -->
            <div id="content">
                



<h4>Save/Load settings</h4>
Let's look at the save/load setting to understand how they can be used to save/load your data during gameplay.
You can find more information about Save/Load <a href="../Addons/SaveLoad">here</a>
<div class="bg-image">
    <a href="../../../../images/BGDatabase/ExampleBreakdown2.png"><img style="width: 400px" src="../../../../images/BGDatabase/ExampleBreakdown2.png"></a>
</div>

<h4>Using "Row level controller" to add new scenes after game release</h4>
<p>
    As you can see on the screenshot above, "Collectables" table has "Add missing" and "Removed orphaned" toggles turned on in the settings.
    It means, that after loading saved data with SaveLoad addon, all "Collectables" rows will be replaced with the saved rows.
    But what if we want to add new scenes with new collectables?
    These new collectables are missing in the saved data, but we do not want them to be removed after game loading.
</p>
<p>
    In such cases, a row controller can be used to prevent certain rows from removing.
    Below is in-depth guide how to achieve it.
</p>
<ol>
   <li>
       First of all we need to add "Version" table with a single row and single "version" int field to keep track of database version
       <div class="bg-image">
           <a href="../../../../images/BGDatabase/3dexample1.png"><img style="width: 200px; height: 100px" src="../../../../images/BGDatabase/3dexample1.png"></a>
       </div>
       and add this table to SaveLoad merge settings
       <div class="bg-image">
           <a href="../../../../images/BGDatabase/3dexample2.png"><img style="width: 200px; height: 100px" src="../../../../images/BGDatabase/3dexample2.png"></a>
       </div>
       Now, whenever you save the data, we can figure out which database version was used.
   </li>
    <li>
        Now let's say our game was already released, and now we want to add a new scene "BEExample3".
        We add a "version" int field to the "Scene" table.
        For existing scenes we keep the value=0, but for the new scene, we set the value to 1 (which means the scene was added to database version 1)
        We also set "Version.version" field value to 1.
        <div class="bg-image">
            <a href="../../../../images/BGDatabase/3dexample3.png"><img style="width: 200px; height: 100px" src="../../../../images/BGDatabase/3dexample3.png"></a>
        </div>
        The saved data has the "Version.version" value of 0 (or maybe the saved data does not contain "Version" table, in this case we also assume the version=0)
        and we can tell, that all "Collectables" rows, related to scenes with version > saved "Version.version" (which is currently equal to 0) should not be removed.
        This trick with increasing "Version.version" and adding new scenes with the new version will also work fine if you want to add new scenes in the future.
        So next time you want to add a new scene ("BEExample4") you can set "Version.version" to 2 and "BEExample4.version" to 2 etc.
    </li>
    <li>
        Now we need to add a row controller, which compare the saved version with the current version
        and if the scene's current version > saved "Version.version" value,
        controller should prevent this scene's "Collectables" rows from removing.
        controller can be assign in "Controller Type" field. Below is the full controller C# code with comments.
        <div class="bg-image">
            <a href="../../../../images/BGDatabase/3dexample4.png"><img style="width: 200px; height: 100px" src="../../../../images/BGDatabase/3dexample4.png"></a>
        </div>
    </li>
</ol>
<details>
    <summary>Full C# code for row controller (click to view)</summary>
<pre class="nomargin"><code class="language-csharp">using System.Collections.Generic;
using BansheeGz.BGDatabase;

//this is SaveLoad row level controller implementation without using CodeGen classes
public class SaveLoadController  : BGMergeSettingsEntity.IMergeReceiver, BGMergeSettingsEntity.IUpdateMatchingReceiver, BGMergeSettingsEntity.IRemoveOrphanedReceiver
{
    //this field is used to detect if it's loading or saving
    private bool loading;
    //this is a set of scene IDs with version &gt; saved version
    private readonly HashSet&lt;BGId&gt; newScenesId = new HashSet&lt;BGId&gt;();
    //this is a "Collectable.Scene" field, which can be used to retrieve the related Scene row for Collectable row
    private BGFieldRelationSingle sceneRelation;

    //this method is called before repos data merging
    public bool OnBeforeMerge(BGRepo from, BGRepo to)
    {
        //here we want to know, if it's loading or saving? If target repo is default repo- it means loading
        loading = to == BGRepo.I;

        if (loading)
        {
            //let's find out the saved version
            var savedVersion = 0;
            var savedVersionMeta = from.GetMeta("Version");
            var savedVersionField = (BGFieldInt)savedVersionMeta?.GetField("version", false);
            if (savedVersionField != null) savedVersion = savedVersionField[0];

            //now let's iterate the scenes and find the scenes with version &gt; savedVersion and add their IDs to newScenesId hashset
            var sceneMeta = to.GetMeta("Scene");
            var versionField = (BGFieldInt)sceneMeta.GetField("version");
            sceneMeta.ForEachEntity(entity =&gt; newScenesId.Add(entity.Id), entity =&gt; versionField[entity.Index] &gt; savedVersion);

            //retrieve "Collectable.Scene" field from default repo (we will use it later)
            sceneRelation = (BGFieldRelationSingle) to.GetMeta("Collectable").GetField("Scene");
        }
        return false;
    }

    public void OnAfterMerge(BGRepo from, BGRepo to)
    {
    }

    //this method is called before row removal, if it returns true, it means the removal is cancelled
    public bool OnBeforeDelete(BGEntity toEntity)
    {
        if (loading)
        {
            //if it's Collectable row
            if (toEntity.MetaName == "Collectable")
            {
                //get related scene ID
                var sceneId = sceneRelation[toEntity.Index].Id;
                //if scene is new, skip Collectable row removal
                if (newScenesId.Contains(sceneId)) return true;
            }
        }
        return false;
    }

    //this method is called before matching row update
    public bool OnBeforeUpdate(BGEntity from, BGEntity to)
    {
        if (loading)
        {
            //we want to use the latest version from default database, skip update
            if (from.MetaName == "Version") return true;
        }
        return false;
    }
}</code></pre>
</details>

<h5>How to see it in action</h5>
<ol>
    <li>Download the example project</li>
    <li>Run it with 2 scenes and save the game</li>
    <li>Add a new scene, add new Collectable rows to it, set "version" field to 1 for the new scene, change "Version.version" to 1</li>
    <li>Run with 3 scenes and load the game. Collectable rows for the new scene should be preserved</li>
</ol>
, save the game,
            </div>
            
            <a class="backToDownloads" href="../" style="margin-top: 10px">&#8592; Back to Downloads</a>
            

            <!--======================================================       BG Database Footer               -->
        </div>

    </div>
</div>



        <!--======================================================      Root Footer               -->
        <footer class="bg-footer mdl-mega-footer" style="clear:both;">
            <div class="mdl-mega-footer--top-section">
                <div class="mdl-mega-footer--middle-section bg-footer-email">
                    <table>
                        <tr>
                            <td>
                                <script language="JavaScript">
                                    writeEmail("support", "bansheegz.com")
                                </script>
                            </td>
                            <td>
                                or
                            </td>
                            <td>
                                <script language="JavaScript">
                                    writeEmail("admin", "bansheegz.com")
                                </script>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div style="text-align: center">
                <div id="share" style="display: inline-block;"></div>
            </div>
        </footer>
    </div>
</div>


</div>

<script defer src="https://code.getmdl.io/1.2.1/material.min.js"></script>

</body>
</html>
